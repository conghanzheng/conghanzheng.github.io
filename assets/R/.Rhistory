# cat("\f") ## clear the console; comment this if you do not use Rstudio
##' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
##'
##'                  Panel Data: Static and Dynamics Models
##'
##' NOTE:
##' 1. No need to specify the path, this script will run as long as you put the
##'    data in the same folder as the script.
##' 2. This script automatically installs and imports packages
##' 3. Text is commented with ##, alternative codes with #.
##'
##' INPUT:
##' 1. Online Data
##'
##' OUTPUT:
##' 1.
##'
##' AUTHOR: Conghan Zheng (https://conghanzheng.github.io)
##' LAST UPDATED: 05 Oct 2024
##'
##' TO-DO:
##' - Find a more efficient package for the dynamic panel models.
## %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
## PRELIMINARIES ----
rm(list = ls()) ## clear the environments
## Auto install and import all packages listed in the vector:
if (!require('pacman')) install.packages('pacman')
library(pacman)
packages <- c('rstudioapi', ## if you use Rstudio
# 'this.path', ## if you don't use Rstudio
'dplyr','haven','zoo','plm','stargazer','data.table','ggplot2',
'patchwork')
pacman::p_load(packages, character.only = TRUE)
invisible(lapply(packages, require, character.only = TRUE, quietly = TRUE))
##' List packages called in this script (package 'NCmisc' required)
##' - This is used to check if some package dependencies have been forgotten.
# if (!require('NCmisc')) install.packages('NCmisc')
# library('NCmisc')
# list.functions.in.file(rstudioapi::getSourceEditorContext()$path, alphabetic = TRUE)
## Change the work directory to (a subdirectory under) that of the current script:
## - if you do not use Rstudio as your IDE:
# scriptpath <- this.dir() %>% setwd()
## - if you are using Rstudio:
scriptpath <- file.path(dirname(rstudioapi::getActiveDocumentContext()$path))
scriptpath %>% setwd()
options(dplyr.summarise.inform = FALSE) ## mute the summarise() info
## Start timer
time_start <- Sys.time()
cat('\n ==== \n Script [',rstudioapi::getSourceEditorContext()$path,'] is running. \n ==== \n') ## Showing this in console helps when you are working on a project of many scripts, Rstudio required
##' TA ----
data_url <- "https://raw.githubusercontent.com/conghanzheng/conghanzheng.github.io/master/assets/R/PanelData.dta"
download.file(data1_url, destfile = "PanelData.dta")
# cat("\f") ## clear the console; comment this if you do not use Rstudio
##' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
##'
##'                  Panel Data: Static and Dynamics Models
##'
##' NOTE:
##' 1. No need to specify the path, this script will run as long as you put the
##'    data in the same folder as the script.
##' 2. This script automatically installs and imports packages
##' 3. Text is commented with ##, alternative codes with #.
##'
##' INPUT:
##' 1. Online Data
##'
##' OUTPUT:
##' 1.
##'
##' AUTHOR: Conghan Zheng (https://conghanzheng.github.io)
##' LAST UPDATED: 05 Oct 2024
##'
##' TO-DO:
##' - Find a more efficient package for the dynamic panel models.
## %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
## PRELIMINARIES ----
rm(list = ls()) ## clear the environments
## Auto install and import all packages listed in the vector:
if (!require('pacman')) install.packages('pacman')
library(pacman)
packages <- c('rstudioapi', ## if you use Rstudio
# 'this.path', ## if you don't use Rstudio
'dplyr','haven','zoo','plm','stargazer','data.table','ggplot2',
'patchwork')
pacman::p_load(packages, character.only = TRUE)
invisible(lapply(packages, require, character.only = TRUE, quietly = TRUE))
##' List packages called in this script (package 'NCmisc' required)
##' - This is used to check if some package dependencies have been forgotten.
# if (!require('NCmisc')) install.packages('NCmisc')
# library('NCmisc')
# list.functions.in.file(rstudioapi::getSourceEditorContext()$path, alphabetic = TRUE)
## Change the work directory to (a subdirectory under) that of the current script:
## - if you do not use Rstudio as your IDE:
# scriptpath <- this.dir() %>% setwd()
## - if you are using Rstudio:
scriptpath <- file.path(dirname(rstudioapi::getActiveDocumentContext()$path))
scriptpath %>% setwd()
options(dplyr.summarise.inform = FALSE) ## mute the summarise() info
## Start timer
time_start <- Sys.time()
cat('\n ==== \n Script [',rstudioapi::getSourceEditorContext()$path,'] is running. \n ==== \n') ## Showing this in console helps when you are working on a project of many scripts, Rstudio required
##' TA ----
data_url <- "https://raw.githubusercontent.com/conghanzheng/conghanzheng.github.io/master/assets/R/PanelData.dta"
download.file(data_url, destfile = "PanelData.dta")
data_raw <- haven::read_dta("PanelData.dta") %>%
data.table::setDT() ## things get quicker with data.table
data_long <- data_raw %>%
pivot_longer(cols = c(n, w, k, y),
names_to = "variable",
values_to = "value") %>% data.table::setDT()
# cat("\f") ## clear the console; comment this if you do not use Rstudio
##' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
##'
##'                  Panel Data: Static and Dynamics Models
##'
##' NOTE:
##' 1. No need to specify the path, this script will run as long as you put the
##'    data in the same folder as the script.
##' 2. This script automatically installs and imports packages
##' 3. Text is commented with ##, alternative codes with #.
##'
##' INPUT:
##' 1. Online Data
##'
##' OUTPUT:
##' 1.
##'
##' AUTHOR: Conghan Zheng (https://conghanzheng.github.io)
##' LAST UPDATED: 05 Oct 2024
##'
##' TO-DO:
##' - Find a more efficient package for the dynamic panel models.
## %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
## PRELIMINARIES ----
rm(list = ls()) ## clear the environments
## Auto install and import all packages listed in the vector:
if (!require('pacman')) install.packages('pacman')
library(pacman)
packages <- c('rstudioapi', ## if you use Rstudio
# 'this.path', ## if you don't use Rstudio
'dplyr','haven','zoo','plm','stargazer','data.table','ggplot2',
'patchwork','tidyr')
pacman::p_load(packages, character.only = TRUE)
invisible(lapply(packages, require, character.only = TRUE, quietly = TRUE))
##' List packages called in this script (package 'NCmisc' required)
##' - This is used to check if some package dependencies have been forgotten.
if (!require('NCmisc')) install.packages('NCmisc')
library('NCmisc')
list.functions.in.file(rstudioapi::getSourceEditorContext()$path, alphabetic = TRUE)
.rs.restartR()
# cat("\f") ## clear the console; comment this if you do not use Rstudio
##' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
##'
##'                  Panel Data: Static and Dynamics Models
##'
##' NOTE:
##' 1. No need to specify the path, this script will run as long as you put the
##'    data in the same folder as the script.
##' 2. This script automatically installs and imports packages
##' 3. Text is commented with ##, alternative codes with #.
##'
##' INPUT:
##' 1. Online Data
##'
##' OUTPUT:
##' 1.
##'
##' AUTHOR: Conghan Zheng (https://conghanzheng.github.io)
##' LAST UPDATED: 05 Oct 2024
##'
##' TO-DO:
##' - Find a more efficient package for the dynamic panel models.
## %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
## PRELIMINARIES ----
rm(list = ls()) ## clear the environments
## Auto install and import all packages listed in the vector:
if (!require('pacman')) install.packages('pacman')
library(pacman)
packages <- c('rstudioapi', ## if you use Rstudio
# 'this.path', ## if you don't use Rstudio
'dplyr','plm','stargazer','haven','data.table','ggplot2',
'patchwork','tidyr')
pacman::p_load(packages, character.only = TRUE)
invisible(lapply(packages, require, character.only = TRUE, quietly = TRUE))
##' List packages called in this script (package 'NCmisc' required)
##' - This is used to check if some package dependencies have been forgotten.
if (!require('NCmisc')) install.packages('NCmisc')
library('NCmisc')
list.functions.in.file(rstudioapi::getSourceEditorContext()$path, alphabetic = TRUE)
## Change the work directory to (a subdirectory under) that of the current script:
## - if you do not use Rstudio as your IDE:
# scriptpath <- this.dir() %>% setwd()
## - if you are using Rstudio:
scriptpath <- file.path(dirname(rstudioapi::getActiveDocumentContext()$path))
scriptpath %>% setwd()
options(dplyr.summarise.inform = FALSE) ## mute the summarise() info
## Start timer
time_start <- Sys.time()
cat('\n ==== \n Script [',rstudioapi::getSourceEditorContext()$path,'] is running. \n ==== \n') ## Showing this in console helps when you are working on a project of many scripts, Rstudio required
##' TA ----
data_url <- "https://raw.githubusercontent.com/conghanzheng/conghanzheng.github.io/master/assets/R/PanelData.dta"
download.file(data_url, destfile = "PanelData.dta")
data_raw <- haven::read_dta("PanelData.dta") %>%
data.table::setDT() ## things get quicker with data.table
## PART I: MANIPULATING PANEL DATA ---------------------------------------------
## The data has variables n, w, k, y with repeated firm-year observations.
data_long <- data_raw %>%
pivot_longer(cols = c(n, w, k, y),
names_to = "variable",
values_to = "value") %>% data.table::setDT()
View(data_raw)
colnames(data_raw)
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year))
View(data_long)
colnames(data_long)
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
data.table::setDT() %>%
order(firm, year)
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
data.table::setDT()
View(data_long)
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
order(firm, year)
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
order(c(firm, year))
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
order(firm, year) %>%
data.table::setDT()
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
arrange(firm, year)
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
arrange(firm, year) %>%
data.table::setDT()
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
data.table::setDT() %>%
arrange(firm, year)
## Overview
summary(data_long)
# cat("\f") ## clear the console; comment this if you do not use Rstudio
##' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
##'
##'                  Panel Data: Static and Dynamics Models
##'
##' NOTE:
##' 1. No need to specify the path, this script will run as long as you put the
##'    data in the same folder as the script.
##' 2. This script automatically installs and imports packages
##' 3. Text is commented with ##, alternative codes with #.
##'
##' INPUT:
##' 1. Online Data
##'
##' OUTPUT:
##' 1.
##'
##' AUTHOR: Conghan Zheng (https://conghanzheng.github.io)
##' LAST UPDATED: 05 Oct 2024
##'
##' TO-DO:
##' - Find a more efficient package for the dynamic panel models.
## %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
## PRELIMINARIES ----
rm(list = ls()) ## clear the environments
## Auto install and import all packages listed in the vector:
if (!require('pacman')) install.packages('pacman')
library(pacman)
packages <- c('rstudioapi', ## if you use Rstudio
# 'this.path', ## if you don't use Rstudio
'dplyr','plm','stargazer','haven','data.table','ggplot2',
'patchwork','tidyr')
pacman::p_load(packages, character.only = TRUE)
invisible(lapply(packages, require, character.only = TRUE, quietly = TRUE))
##' List packages called in this script (package 'NCmisc' required)
##' - This is used to check if some package dependencies have been forgotten.
if (!require('NCmisc')) install.packages('NCmisc')
library('NCmisc')
list.functions.in.file(rstudioapi::getSourceEditorContext()$path, alphabetic = TRUE)
## Change the work directory to (a subdirectory under) that of the current script:
## - if you do not use Rstudio as your IDE:
# scriptpath <- this.dir() %>% setwd()
## - if you are using Rstudio:
scriptpath <- file.path(dirname(rstudioapi::getActiveDocumentContext()$path))
scriptpath %>% setwd()
options(dplyr.summarise.inform = FALSE) ## mute the summarise() info
## Start timer
time_start <- Sys.time()
cat('\n ==== \n Script [',rstudioapi::getSourceEditorContext()$path,'] is running. \n ==== \n') ## Showing this in console helps when you are working on a project of many scripts, Rstudio required
##' TA ----
data_url <- "https://raw.githubusercontent.com/conghanzheng/conghanzheng.github.io/master/assets/R/PanelData.dta"
download.file(data_url, destfile = "PanelData.dta")
data_raw <- haven::read_dta("PanelData.dta") %>%
data.table::setDT() ## things get quicker with data.table
## PART I: MANIPULATING PANEL DATA ---------------------------------------------
## The data has variables n, w, k, y with repeated firm-year observations.
data_long <- data_raw %>%
tidyr::pivot_longer(
cols = -firm,
names_to = c(".value", "year"),
names_pattern = "([nwky])([0-9]{4})"
) %>%
mutate(year = as.integer(year)) %>%
data.table::setDT() %>%
arrange(firm, year) %>% ## order by firm and year
filter(if_all(c(n, w, k, y), ~ !is.na(.))) %>% ## Drop missing (in all variables n, w, k, y)
group_by(firm) %>%
mutate(count_byfirm = n()) %>%
ungroup() %>%
filter(count_byfirm > 1) %>% ## Exclude single observations (firms that only appear once)
select(-count_byfirm) %>%
distinct(firm, year, .keep_all = TRUE) ## Exclude duplicates: keep first appearances per firm-year
## Overview
summary(data_long)
